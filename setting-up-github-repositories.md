# Setting up github repositories for specifications

This document tries to describe how we set up github repositories
for specifications or specification-like documents.
These documents are generally maintained in either
[bikeshed](https://github.com/tabatkins/bikeshed/)
or
[respec](https://github.com/w3c/respec/).

Also see [W3C's FAQ on using GitHub](https://w3c.github.io/faq.html).

## Structuring the repository

The primary branch of the repository should be `master`, which is `git`'s default.  (We should not manually interact with a `gh-pages` branch, although some older repositories are set up to do so.)

This branch should contain only the source; files generated by bikeshed (or respec) should not be committed.

## Configuring the document

**TODO**: Write something about how to configure settings in bikeshed and in respec.

## Configuring github settings

After creating the repository, change the following aspects of its settings:
1. In the **Options** tab, under **Merge button**, uncheck **Allow merge commits**
2. In the **Options** tab, under **GitHub Pages**, set the **Source**:
   * for bikeshed specs, set it to **gh-pages**
   * for respec specs, set it to **master**  (note that some older specs use `gh-pages`, but this is no longer needed; we can always use `master` as what we commit to)
3. In the **Branches** tab, under **Branch protection rules**, choose **Add rule**.  Create a rule matching `master`, and check the two checkboxes **Require linear history** and **Include administrators**.  (Also *consider* whether to check **Require pull request reviews before merging** or **Require status checks to pass before merging**.)

## Configuring automatic running of bikeshed

For bikeshed specs, we set up autogeneration of the bikeshed output from the source.
The source is (as described above) on the `master` branch,
and we set up automatic running of `bikeshed` to generate its output and commit it to the `gh-pages` branch.

This is done by roughly following the steps in
[Domenic's gist](https://gist.github.com/domenic/ec8b0fc8ab45f39403dd),
(though it's worth looking at the version history of that gist since the older versions had more detail in some ways).
It may be useful to copy the 
[`deploy-gh-pages.sh` in `design-principles`](https://github.com/w3ctag/design-principles/blob/master/deploy-gh-pages.sh).

**TODO**: Expand on this the next time one of us does it.

## Configuring PR Preview

We have **already** set up [PR Preview](https://github.com/tobie/pr-preview) by using the steps:
1. go to [PR Preview GitHub App](https://github.com/apps/pr-preview)
2. click **Configure** on the right
3. Choose the @w3ctag organization
4. choose to set it up for **All repositories**

This means that all we need to enable PR Preview is to add a `.pr-preview.json`, which is easiest to do by using the [PR Preview setup helper](https://tobie.github.io/pr-preview/config.html) and choosing the appropriate defaults there.
